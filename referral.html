<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="menu-header">
            <div class="menu-item">REFERRAL</div>
            <div class="menu-item bonus">BONUS COMMISSION</div>
        </div>
        <div class="header">
            <div class="title">Your Reward</h2>
                <div class="description">You will get <span class="rate-text">0.15%</span> F1 trading volume when
                    milestones are reached</div>
            </div>
        </div>
        <div class="progress-container" data-milestone=5000000>
            <!-- phone View -->
            <div class="phone">
                <div class="progress-wrapper old">
                    <div class="progress-item" data-value=500000>
                        <span>$500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=1000000>
                        <span>$1.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                </div>
                <div class="progress-space"></div>
                <div class="progress-wrapper event">
                    <div class="progress-item" data-value=1500000>
                        <span>$1.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=2000000>
                        <span>$2.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                </div>
                <div class="progress-space progress-space-left"></div>
                <div class="progress-wrapper old">
                    <div class="progress-item" data-value=2500000>
                        <span>$2.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=3000000>
                        <span>$3.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                </div>
                <div class="progress-space"></div>
                <div class="progress-wrapper event">
                    <div class="progress-item" data-value=3500000>
                        <span>$3.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=4000000>
                        <span>$4.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                </div>
                <div class="progress-space progress-space-left"></div>
                <div class="progress-wrapper old">
                    <div class="progress-item" data-value=4500000>
                        <span>$4.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=5000000>
                        <span>$5.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                </div>
            </div>

            <!-- Desktop View -->
            <div class="desktop">
                <div class="progress-wrapper progress-top">
                    <div class="first-space active"></div>
                    <div class="progress-item" data-value=500000>
                        <span>$500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=1000000>
                        <span>$1.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=1500000>
                        <span>$1.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=2000000>
                        <span>$2.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=2500000>
                        <span>$2.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-item-corner highlight"></div>
                </div>
                <div class="progress-space highlight over"></div>
                <div class="progress-wrapper progress-bottom">
                    <div class="progress-item-corner highlight"></div>
                    <div class="progress-item" data-value=3000000>
                        <span class="reward-value">$3.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=3500000>
                        <span class="reward-value">$3.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=4000000>
                        <span>$4.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=4500000>
                        <span>$4.500.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="progress-rate">
                        <div class="rate"></div>
                    </div>
                    <div class="progress-item" data-value=5000000>
                        <span>$5.000.000</span>
                        <button class="btn-reward">Get Reward</button>
                    </div>
                    <div class="last-space active"></div>

                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="myModal" class="modal hidden">
            <div class="modal-content">
                <img class="modal-image" src="./image/coin.png" alt="">
                <div class="modal-title text-center">
                    <div>
                        <img src="./image/icon-success.png" class="icon-success">
                        <span>Congratulation</span>
                    </div>
                    <div class="modal-reward">+ $750.00</div>
                </div>
                <span class="btn-close">X</span>
                <!-- <div class="text-center">
                    <button class="btn-complete">Complete</button>
                </div> -->
            </div>
        </div>
        <script>
            const offsetMilestone = 500000;
            const maxMilestone = 5000000;
            var modal = document.getElementById("myModal");
            var btnClose = document.querySelector(".btn-close");
            var btnRewardDesktop = document.querySelectorAll('.desktop .progress-item .btn-reward');
            var btnRewardPhone = document.querySelectorAll('.phone .progress-item .btn-reward');
            if (btnClose) {
                btnClose.addEventListener('click', function () {
                    modal.classList.add('hidden')
                })
            }

            [...btnRewardDesktop, ...btnRewardPhone].forEach(button => {
                button.addEventListener('click', function () {
                    if (this.classList.contains('active')) {
                        modal.classList.remove('hidden');
                        this.classList.remove('active');
                    }
                })
            });

            // Handle rate progress - Phone
            function milestonePhone() {
                var dataMilestone = parseInt(
                    document.querySelector(".progress-container")
                        .dataset
                        .milestone);
                var listRate = [...document.querySelectorAll('.phone .progress-rate')];
                var progressItems = [...document.querySelectorAll('.phone .progress-item')];
                var itemActives = progressItems.filter(item => item.dataset.value <= dataMilestone);
                var valueLastItem = parseInt(
                    itemActives[itemActives.length - 1]
                        .dataset
                        .value)
                itemActives.map(item => item.classList.add('active'));
                var rateQuantity;
                if (itemActives.length % 2 == 0) {
                    rateQuantity = itemActives.length / 2
                } else {
                    rateQuantity = (itemActives.length + 1) / 2
                }
                console.log(rateQuantity);
                var btnRewardActives = [...btnRewardPhone].slice(0, itemActives.length);
                var rateActives = listRate.slice(0, rateQuantity);
                var rateRadius = (dataMilestone - valueLastItem) * 100 / offsetMilestone;
                btnRewardActives.map(button => button.classList.add('active'));
                rateActives.map((item, index) => {
                    item.classList.add('active');
                    if (index == (rateQuantity - 1) && (itemActives.length % 2 != 0)) {
                        item.classList.add('over');
                        item.children[0].style.width = `${rateRadius}%`;
                    }
                });

                //High light bar space
                var progressSpace = [...document.querySelectorAll('.phone .progress-space')];
                var progressSpaceActives = progressSpace.slice(0, (rateQuantity - 1));
                progressSpaceActives.map(item => item.classList.add('active'))

                // High light corner
                var progressWrapper = [...document.querySelectorAll('.phone .progress-wrapper')];
                console.log(rateQuantity)
                var progressWrapperActives = progressWrapper.slice(0, rateQuantity);
                getMaxValue = (arr) => {
                    var maxVal = 0;
                    arr.map(item => {
                        if (item.dataset.value) {
                            let value = parseInt(item.dataset.value);
                            maxVal = value > maxVal ? value : maxVal;
                        }
                    });
                    return maxVal;
                }
                progressWrapperActives.map(item => {
                    if (item.classList.contains('old')) {
                        var maxVal = getMaxValue([...item.children]);
                        if (dataMilestone >= maxVal + offsetMilestone || dataMilestone == maxMilestone) {
                            item.classList.add('corner-l-r');
                        } else {
                            item.classList.add('corner-l');
                        }
                    } else if (item.classList.contains('event')) {
                        var maxVal = getMaxValue([...item.children]);
                        if (dataMilestone >= maxVal + offsetMilestone) {
                            item.classList.add('corner-l-r');
                        } else {
                            item.classList.add('corner-r');
                        }
                    }
                })

            }
            milestonePhone();

            // Handle rate progress - Desktop
            function milestoneDesktop() {
                var dataMilestone = parseInt(
                    document.querySelector(".progress-container")
                        .dataset
                        .milestone);
                var listRate = [...document.querySelectorAll('.desktop .progress-rate')];
                var progressItems = [...document.querySelectorAll('.desktop .progress-item')];
                var itemActives = progressItems.filter(item => item.dataset.value <= dataMilestone);


                var valueLastItem = parseInt(
                    itemActives[itemActives.length - 1]
                        .dataset
                        .value)
                itemActives.map(item => item.classList.add('active'))
                var rateQuantity;
                if (itemActives.length <= 4) {
                    rateQuantity = itemActives.length
                } else if (itemActives.length == 10) {
                    rateQuantity = 8;
                } else {
                    rateQuantity = itemActives.length - 1
                }
                var btnRewardActives = [...btnRewardDesktop].slice(0, itemActives.length);
                var rateActives = listRate.slice(0, rateQuantity);
                var rateRadius = (dataMilestone - valueLastItem) * 100 / offsetMilestone;
                var highlightEle = [...document.querySelectorAll('.highlight')];
                if (itemActives.length > 5) {
                    highlightEle.map(item => item.classList.add('active'));
                }

                btnRewardActives.map(button => button.classList.add('active'))
                rateActives.map((item, index) => {
                    item.classList.add('active');
                    if ((index == (rateQuantity - 1)) && itemActives.length != 10 && itemActives.length != 5) {
                        item.classList.add('over');
                        item.children[0].style.width = `${rateRadius}%`;
                    }
                })
            }
            milestoneDesktop();


        </script>
</body>

</html>